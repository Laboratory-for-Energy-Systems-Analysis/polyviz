<!--
Library     : d3blocks
Author      : E.Taskesen, O.Verver
Mail        : erdogant@gmail.com, oliver@sensibly.nl
Github      : https://github.com/d3blocks/d3blocks
Licensed    : GPL3
Forked      : Mike Bostock; https://observablehq.com/@d3/directed-chord-diagram
-->

<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>"ethanol production from maize (kilogram, RoW), kg CO2-Eq"</title>
</head>
<body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.2/d3.min.js"></script>
<script src="https://unpkg.com/topojson@3"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>

<script>
	// Copyright 2021, Observable Inc.
// Released under the ISC license.

function renderHtml(string) {
  const template = document.createElement("template");
  template.innerHTML = string;
  return document.importNode(template.content, true);
}

function renderSvg(string) {
  const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
  g.innerHTML = string;
  return g;
}

const html = Object.assign(hypertext(renderHtml, fragment => {
  if (fragment.firstChild === null) return null;
  if (fragment.firstChild === fragment.lastChild) return fragment.removeChild(fragment.firstChild);
  const span = document.createElement("span");
  span.appendChild(fragment);
  return span;
}), {fragment: hypertext(renderHtml, fragment => fragment)});

const svg = Object.assign(hypertext(renderSvg, g => {
  if (g.firstChild === null) return null;
  if (g.firstChild === g.lastChild) return g.removeChild(g.firstChild);
  return g;
}), {fragment: hypertext(renderSvg, g => {
  const fragment = document.createDocumentFragment();
  while (g.firstChild) fragment.appendChild(g.firstChild);
  return fragment;
})});

const
CODE_TAB = 9,
CODE_LF = 10,
CODE_FF = 12,
CODE_CR = 13,
CODE_SPACE = 32,
CODE_UPPER_A = 65,
CODE_UPPER_Z = 90,
CODE_LOWER_A = 97,
CODE_LOWER_Z = 122,
CODE_LT = 60,
CODE_GT = 62,
CODE_SLASH = 47,
CODE_DASH = 45,
CODE_BANG = 33,
CODE_EQ = 61,
CODE_DQUOTE = 34,
CODE_SQUOTE = 39,
CODE_QUESTION = 63,
STATE_DATA = 1,
STATE_TAG_OPEN = 2,
STATE_END_TAG_OPEN = 3,
STATE_TAG_NAME = 4,
STATE_BOGUS_COMMENT = 5,
STATE_BEFORE_ATTRIBUTE_NAME = 6,
STATE_AFTER_ATTRIBUTE_NAME = 7,
STATE_ATTRIBUTE_NAME = 8,
STATE_BEFORE_ATTRIBUTE_VALUE = 9,
STATE_ATTRIBUTE_VALUE_DOUBLE_QUOTED = 10,
STATE_ATTRIBUTE_VALUE_SINGLE_QUOTED = 11,
STATE_ATTRIBUTE_VALUE_UNQUOTED = 12,
STATE_AFTER_ATTRIBUTE_VALUE_QUOTED = 13,
STATE_SELF_CLOSING_START_TAG = 14,
STATE_COMMENT_START = 15,
STATE_COMMENT_START_DASH = 16,
STATE_COMMENT = 17,
STATE_COMMENT_LESS_THAN_SIGN = 18,
STATE_COMMENT_LESS_THAN_SIGN_BANG = 19,
STATE_COMMENT_LESS_THAN_SIGN_BANG_DASH = 20,
STATE_COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH = 21,
STATE_COMMENT_END_DASH = 22,
STATE_COMMENT_END = 23,
STATE_COMMENT_END_BANG = 24,
STATE_MARKUP_DECLARATION_OPEN = 25,
STATE_RAWTEXT = 26,
STATE_RAWTEXT_LESS_THAN_SIGN = 27,
STATE_RAWTEXT_END_TAG_OPEN = 28,
STATE_RAWTEXT_END_TAG_NAME = 29,
SHOW_COMMENT = 128,
SHOW_ELEMENT = 1,
TYPE_COMMENT = 8,
TYPE_ELEMENT = 1,
NS_SVG = "http://www.w3.org/2000/svg",
NS_XLINK = "http://www.w3.org/1999/xlink",
NS_XML = "http://www.w3.org/XML/1998/namespace",
NS_XMLNS = "http://www.w3.org/2000/xmlns/";

const svgAdjustAttributes = new Map([
  "attributeName",
  "attributeType",
  "baseFrequency",
  "baseProfile",
  "calcMode",
  "clipPathUnits",
  "diffuseConstant",
  "edgeMode",
  "filterUnits",
  "glyphRef",
  "gradientTransform",
  "gradientUnits",
  "kernelMatrix",
  "kernelUnitLength",
  "keyPoints",
  "keySplines",
  "keyTimes",
  "lengthAdjust",
  "limitingConeAngle",
  "markerHeight",
  "markerUnits",
  "markerWidth",
  "maskContentUnits",
  "maskUnits",
  "numOctaves",
  "pathLength",
  "patternContentUnits",
  "patternTransform",
  "patternUnits",
  "pointsAtX",
  "pointsAtY",
  "pointsAtZ",
  "preserveAlpha",
  "preserveAspectRatio",
  "primitiveUnits",
  "refX",
  "refY",
  "repeatCount",
  "repeatDur",
  "requiredExtensions",
  "requiredFeatures",
  "specularConstant",
  "specularExponent",
  "spreadMethod",
  "startOffset",
  "stdDeviation",
  "stitchTiles",
  "surfaceScale",
  "systemLanguage",
  "tableValues",
  "targetX",
  "targetY",
  "textLength",
  "viewBox",
  "viewTarget",
  "xChannelSelector",
  "yChannelSelector",
  "zoomAndPan"
].map(name => [name.toLowerCase(), name]));

const svgForeignAttributes = new Map([
  ["xlink:actuate", NS_XLINK],
  ["xlink:arcrole", NS_XLINK],
  ["xlink:href", NS_XLINK],
  ["xlink:role", NS_XLINK],
  ["xlink:show", NS_XLINK],
  ["xlink:title", NS_XLINK],
  ["xlink:type", NS_XLINK],
  ["xml:lang", NS_XML],
  ["xml:space", NS_XML],
  ["xmlns", NS_XMLNS],
  ["xmlns:xlink", NS_XMLNS]
]);

function hypertext(render, postprocess) {
  return function({raw: strings}) {
    let state = STATE_DATA;
    let string = "";
    let tagNameStart; // either an open tag or an end tag
    let tagName; // only open; beware nesting! used only for rawtext
    let attributeNameStart;
    let attributeNameEnd;
    let nodeFilter = 0;

    for (let j = 0, m = arguments.length; j < m; ++j) {
      const input = strings[j];

      if (j > 0) {
        const value = arguments[j];
        switch (state) {
          case STATE_RAWTEXT: {
            if (value != null) {
              const text = `${value}`;
              if (isEscapableRawText(tagName)) {
                string += text.replace(/[<]/g, entity);
              } else if (new RegExp(`</${tagName}[\\s>/]`, "i").test(string.slice(-tagName.length - 2) + text)) {
                throw new Error("unsafe raw text"); // appropriate end tag
              } else {
                string += text;
              }
            }
            break;
          }
          case STATE_DATA: {
            if (value == null) {
              // ignore
            } else if (value instanceof Node
                || (typeof value !== "string" && value[Symbol.iterator])
                || (/(?:^|>)$/.test(strings[j - 1]) && /^(?:<|$)/.test(input))) {
              string += "<!--::" + j + "-->";
              nodeFilter |= SHOW_COMMENT;
            } else {
              string += `${value}`.replace(/[<&]/g, entity);
            }
            break;
          }
          case STATE_BEFORE_ATTRIBUTE_VALUE: {
            state = STATE_ATTRIBUTE_VALUE_UNQUOTED;
            let text;
            if (/^[\s>]/.test(input)) {
              if (value == null || value === false) {
                string = string.slice(0, attributeNameStart - strings[j - 1].length);
                break;
              }
              if (value === true || (text = `${value}`) === "") {
                string += "''";
                break;
              }
              const name = strings[j - 1].slice(attributeNameStart, attributeNameEnd);
              if ((name === "style" && isObjectLiteral(value)) || typeof value === "function") {
                string += "::" + j;
                nodeFilter |= SHOW_ELEMENT;
                break;
              }
            }
            if (text === undefined) text = `${value}`;
            if (text === "") throw new Error("unsafe unquoted empty string");
            string += text.replace(/^['"]|[\s>&]/g, entity);
            break;
          }
          case STATE_ATTRIBUTE_VALUE_UNQUOTED: {
            string += `${value}`.replace(/[\s>&]/g, entity);
            break;
          }
          case STATE_ATTRIBUTE_VALUE_SINGLE_QUOTED: {
            string += `${value}`.replace(/['&]/g, entity);
            break;
          }
          case STATE_ATTRIBUTE_VALUE_DOUBLE_QUOTED: {
            string += `${value}`.replace(/["&]/g, entity);
            break;
          }
          case STATE_BEFORE_ATTRIBUTE_NAME: {
            if (isObjectLiteral(value)) {
              string += "::" + j + "=''";
              nodeFilter |= SHOW_ELEMENT;
              break;
            }
            throw new Error("invalid binding");
          }
          case STATE_COMMENT: break;
          default: throw new Error("invalid binding");
        }
      }

      for (let i = 0, n = input.length; i < n; ++i) {
        const code = input.charCodeAt(i);

        switch (state) {
          case STATE_DATA: {
            if (code === CODE_LT) {
              state = STATE_TAG_OPEN;
            }
            break;
          }
          case STATE_TAG_OPEN: {
            if (code === CODE_BANG) {
              state = STATE_MARKUP_DECLARATION_OPEN;
            } else if (code === CODE_SLASH) {
              state = STATE_END_TAG_OPEN;
            } else if (isAsciiAlphaCode(code)) {
              tagNameStart = i, tagName = undefined;
              state = STATE_TAG_NAME, --i;
            } else if (code === CODE_QUESTION) {
              state = STATE_BOGUS_COMMENT, --i;
            } else {
              state = STATE_DATA, --i;
            }
            break;
          }
          case STATE_END_TAG_OPEN: {
            if (isAsciiAlphaCode(code)) {
              state = STATE_TAG_NAME, --i;
            } else if (code === CODE_GT) {
              state = STATE_DATA;
            } else {
              state = STATE_BOGUS_COMMENT, --i;
            }
            break;
          }
          case STATE_TAG_NAME: {
            if (isSpaceCode(code)) {
              state = STATE_BEFORE_ATTRIBUTE_NAME;
              tagName = lower(input, tagNameStart, i);
            } else if (code === CODE_SLASH) {
              state = STATE_SELF_CLOSING_START_TAG;
            } else if (code === CODE_GT) {
              tagName = lower(input, tagNameStart, i);
              state = isRawText(tagName) ? STATE_RAWTEXT : STATE_DATA;
            }
            break;
          }
          case STATE_BEFORE_ATTRIBUTE_NAME: {
            if (isSpaceCode(code)) {
              // continue
            } else if (code === CODE_SLASH || code === CODE_GT) {
              state = STATE_AFTER_ATTRIBUTE_NAME, --i;
            } else if (code === CODE_EQ) {
              state = STATE_ATTRIBUTE_NAME;
              attributeNameStart = i + 1, attributeNameEnd = undefined;
            } else {
              state = STATE_ATTRIBUTE_NAME, --i;
              attributeNameStart = i + 1, attributeNameEnd = undefined;
            }
            break;
          }
          case STATE_ATTRIBUTE_NAME: {
            if (isSpaceCode(code) || code === CODE_SLASH || code === CODE_GT) {
              state = STATE_AFTER_ATTRIBUTE_NAME, --i;
              attributeNameEnd = i;
            } else if (code === CODE_EQ) {
              state = STATE_BEFORE_ATTRIBUTE_VALUE;
              attributeNameEnd = i;
            }
            break;
          }
          case STATE_AFTER_ATTRIBUTE_NAME: {
            if (isSpaceCode(code)) {
              // ignore
            } else if (code === CODE_SLASH) {
              state = STATE_SELF_CLOSING_START_TAG;
            } else if (code === CODE_EQ) {
              state = STATE_BEFORE_ATTRIBUTE_VALUE;
            } else if (code === CODE_GT) {
              state = isRawText(tagName) ? STATE_RAWTEXT : STATE_DATA;
            } else {
              state = STATE_ATTRIBUTE_NAME, --i;
              attributeNameStart = i + 1, attributeNameEnd = undefined;
            }
            break;
          }
          case STATE_BEFORE_ATTRIBUTE_VALUE: {
            if (isSpaceCode(code)) {
              // continue
            } else if (code === CODE_DQUOTE) {
              state = STATE_ATTRIBUTE_VALUE_DOUBLE_QUOTED;
            } else if (code === CODE_SQUOTE) {
              state = STATE_ATTRIBUTE_VALUE_SINGLE_QUOTED;
            } else if (code === CODE_GT) {
              state = isRawText(tagName) ? STATE_RAWTEXT : STATE_DATA;
            } else {
              state = STATE_ATTRIBUTE_VALUE_UNQUOTED, --i;
            }
            break;
          }
          case STATE_ATTRIBUTE_VALUE_DOUBLE_QUOTED: {
            if (code === CODE_DQUOTE) {
              state = STATE_AFTER_ATTRIBUTE_VALUE_QUOTED;
            }
            break;
          }
          case STATE_ATTRIBUTE_VALUE_SINGLE_QUOTED: {
            if (code === CODE_SQUOTE) {
              state = STATE_AFTER_ATTRIBUTE_VALUE_QUOTED;
            }
            break;
          }
          case STATE_ATTRIBUTE_VALUE_UNQUOTED: {
            if (isSpaceCode(code)) {
              state = STATE_BEFORE_ATTRIBUTE_NAME;
            } else if (code === CODE_GT) {
              state = isRawText(tagName) ? STATE_RAWTEXT : STATE_DATA;
            }
            break;
          }
          case STATE_AFTER_ATTRIBUTE_VALUE_QUOTED: {
            if (isSpaceCode(code)) {
              state = STATE_BEFORE_ATTRIBUTE_NAME;
            } else if (code === CODE_SLASH) {
              state = STATE_SELF_CLOSING_START_TAG;
            } else if (code === CODE_GT) {
              state = isRawText(tagName) ? STATE_RAWTEXT : STATE_DATA;
            } else {
              state = STATE_BEFORE_ATTRIBUTE_NAME, --i;
            }
            break;
          }
          case STATE_SELF_CLOSING_START_TAG: {
            if (code === CODE_GT) {
              state = STATE_DATA;
            } else {
              state = STATE_BEFORE_ATTRIBUTE_NAME, --i;
            }
            break;
          }
          case STATE_BOGUS_COMMENT: {
            if (code === CODE_GT) {
              state = STATE_DATA;
            }
            break;
          }
          case STATE_COMMENT_START: {
            if (code === CODE_DASH) {
              state = STATE_COMMENT_START_DASH;
            } else if (code === CODE_GT) {
              state = STATE_DATA;
            } else {
              state = STATE_COMMENT, --i;
            }
            break;
          }
          case STATE_COMMENT_START_DASH: {
            if (code === CODE_DASH) {
              state = STATE_COMMENT_END;
            } else if (code === CODE_GT) {
              state = STATE_DATA;
            } else {
              state = STATE_COMMENT, --i;
            }
            break;
          }
          case STATE_COMMENT: {
            if (code === CODE_LT) {
              state = STATE_COMMENT_LESS_THAN_SIGN;
            } else if (code === CODE_DASH) {
              state = STATE_COMMENT_END_DASH;
            }
            break;
          }
          case STATE_COMMENT_LESS_THAN_SIGN: {
            if (code === CODE_BANG) {
              state = STATE_COMMENT_LESS_THAN_SIGN_BANG;
            } else if (code !== CODE_LT) {
              state = STATE_COMMENT, --i;
            }
            break;
          }
          case STATE_COMMENT_LESS_THAN_SIGN_BANG: {
            if (code === CODE_DASH) {
              state = STATE_COMMENT_LESS_THAN_SIGN_BANG_DASH;
            } else {
              state = STATE_COMMENT, --i;
            }
            break;
          }
          case STATE_COMMENT_LESS_THAN_SIGN_BANG_DASH: {
            if (code === CODE_DASH) {
              state = STATE_COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH;
            } else {
              state = STATE_COMMENT_END, --i;
            }
            break;
          }
          case STATE_COMMENT_LESS_THAN_SIGN_BANG_DASH_DASH: {
            state = STATE_COMMENT_END, --i;
            break;
          }
          case STATE_COMMENT_END_DASH: {
            if (code === CODE_DASH) {
              state = STATE_COMMENT_END;
            } else {
              state = STATE_COMMENT, --i;
            }
            break;
          }
          case STATE_COMMENT_END: {
            if (code === CODE_GT) {
              state = STATE_DATA;
            } else if (code === CODE_BANG) {
              state = STATE_COMMENT_END_BANG;
            } else if (code !== CODE_DASH) {
              state = STATE_COMMENT, --i;
            }
            break;
          }
          case STATE_COMMENT_END_BANG: {
            if (code === CODE_DASH) {
              state = STATE_COMMENT_END_DASH;
            } else if (code === CODE_GT) {
              state = STATE_DATA;
            } else {
              state = STATE_COMMENT, --i;
            }
            break;
          }
          case STATE_MARKUP_DECLARATION_OPEN: {
            if (code === CODE_DASH && input.charCodeAt(i + 1) === CODE_DASH) {
              state = STATE_COMMENT_START, ++i;
            } else { // Note: CDATA and DOCTYPE unsupported!
              state = STATE_BOGUS_COMMENT, --i;
            }
            break;
          }
          case STATE_RAWTEXT: {
            if (code === CODE_LT) {
              state = STATE_RAWTEXT_LESS_THAN_SIGN;
            }
            break;
          }
          case STATE_RAWTEXT_LESS_THAN_SIGN: {
            if (code === CODE_SLASH) {
              state = STATE_RAWTEXT_END_TAG_OPEN;
            } else {
              state = STATE_RAWTEXT, --i;
            }
            break;
          }
          case STATE_RAWTEXT_END_TAG_OPEN: {
            if (isAsciiAlphaCode(code)) {
              tagNameStart = i;
              state = STATE_RAWTEXT_END_TAG_NAME, --i;
            } else {
              state = STATE_RAWTEXT, --i;
            }
            break;
          }
          case STATE_RAWTEXT_END_TAG_NAME: {
            if (isSpaceCode(code) && tagName === lower(input, tagNameStart, i)) {
              state = STATE_BEFORE_ATTRIBUTE_NAME;
            } else if (code === CODE_SLASH && tagName === lower(input, tagNameStart, i)) {
              state = STATE_SELF_CLOSING_START_TAG;
            } else if (code === CODE_GT && tagName === lower(input, tagNameStart, i)) {
              state = STATE_DATA;
            } else if (!isAsciiAlphaCode(code)) {
              state = STATE_RAWTEXT, --i;
            }
            break;
          }
          default: {
            state = undefined;
            break;
          }
        }
      }

      string += input;
    }

    const root = render(string);

    const walker = document.createTreeWalker(root, nodeFilter, null, false);
    const removeNodes = [];
    while (walker.nextNode()) {
      const node = walker.currentNode;
      switch (node.nodeType) {
        case TYPE_ELEMENT: {
          const attributes = node.attributes;
          for (let i = 0, n = attributes.length; i < n; ++i) {
            const {name, value: currentValue} = attributes[i];
            if (/^::/.test(name)) {
              const value = arguments[+name.slice(2)];
              removeAttribute(node, name), --i, --n;
              for (const key in value) {
                const subvalue = value[key];
                if (subvalue == null || subvalue === false) {
                  // ignore
                } else if (typeof subvalue === "function") {
                  node[key] = subvalue;
                } else if (key === "style" && isObjectLiteral(subvalue)) {
                  setStyles(node[key], subvalue);
                } else {
                  setAttribute(node, key, subvalue === true ? "" : subvalue);
                }
              }
            } else if (/^::/.test(currentValue)) {
              const value = arguments[+currentValue.slice(2)];
              removeAttribute(node, name), --i, --n;
              if (typeof value === "function") {
                node[name] = value;
              } else { // style
                setStyles(node[name], value);
              }
            }
          }
          break;
        }
        case TYPE_COMMENT: {
          if (/^::/.test(node.data)) {
            const parent = node.parentNode;
            const value = arguments[+node.data.slice(2)];
            if (value instanceof Node) {
              parent.insertBefore(value, node);
            } else if (typeof value !== "string" && value[Symbol.iterator]) {
              if (value instanceof NodeList || value instanceof HTMLCollection) {
                for (let i = value.length - 1, r = node; i >= 0; --i) {
                  r = parent.insertBefore(value[i], r);
                }
              } else {
                for (const subvalue of value) {
                  if (subvalue == null) continue;
                  parent.insertBefore(subvalue instanceof Node ? subvalue : document.createTextNode(subvalue), node);
                }
              }
            } else {
              parent.insertBefore(document.createTextNode(value), node);
            }
            removeNodes.push(node);
          }
          break;
        }
      }
    }

    for (const node of removeNodes) {
      node.parentNode.removeChild(node);
    }

    return postprocess(root);
  };
}

function entity(character) {
  return `&#${character.charCodeAt(0).toString()};`;
}

function isAsciiAlphaCode(code) {
  return (CODE_UPPER_A <= code && code <= CODE_UPPER_Z)
      || (CODE_LOWER_A <= code && code <= CODE_LOWER_Z);
}

function isSpaceCode(code) {
  return code === CODE_TAB
      || code === CODE_LF
      || code === CODE_FF
      || code === CODE_SPACE
      || code === CODE_CR; // normalize newlines
}

function isObjectLiteral(value) {
  return value && value.toString === Object.prototype.toString;
}

function isRawText(tagName) {
  return tagName === "script" || tagName === "style" || isEscapableRawText(tagName);
}

function isEscapableRawText(tagName) {
  return tagName === "textarea" || tagName === "title";
}

function lower(input, start, end) {
  return input.slice(start, end).toLowerCase();
}

function setAttribute(node, name, value) {
  if (node.namespaceURI === NS_SVG) {
    name = name.toLowerCase();
    name = svgAdjustAttributes.get(name) || name;
    if (svgForeignAttributes.has(name)) {
      node.setAttributeNS(svgForeignAttributes.get(name), name, value);
      return;
    }
  }
  node.setAttribute(name, value);
}

function removeAttribute(node, name) {
  if (node.namespaceURI === NS_SVG) {
    name = name.toLowerCase();
    name = svgAdjustAttributes.get(name) || name;
    if (svgForeignAttributes.has(name)) {
      node.removeAttributeNS(svgForeignAttributes.get(name), name);
      return;
    }
  }
  node.removeAttribute(name);
}

// We can’t use Object.assign because custom properties…
function setStyles(style, values) {
  for (const name in values) {
    const value = values[name];
    if (name.startsWith("--")) style.setProperty(name, value);
    else style[name] = value;
  }
}
	// Copyright 2021, Observable Inc.
// Released under the ISC license.
// https://observablehq.com/@d3/color-legend
function Swatches(color, {
  columns = null,
  format,
  unknown: formatUnknown,
  swatchSize = 15,
  swatchWidth = swatchSize,
  swatchHeight = swatchSize,
  marginLeft = 0
} = {}) {
  const id = `-swatches-${Math.random().toString(16).slice(2)}`;
  const unknown = formatUnknown == null ? undefined : color.unknown();
  const unknowns = unknown == null || unknown === d3.scaleImplicit ? [] : [unknown];
  const domain = color.domain().concat(unknowns);
  if (format === undefined) format = x => x === unknown ? formatUnknown : x;

  function entity(character) {
    return `&#${character.charCodeAt(0).toString()};`;
  }

  if (columns !== null) return html`<div style="display: flex; align-items: center; margin-left: ${+marginLeft}px; min-height: 33px; font: 10px sans-serif;">
  <style>

.${id}-item {
  break-inside: avoid;
  display: flex;
  align-items: center;
  padding-bottom: 1px;
}

.${id}-label {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: calc(100% - ${+swatchWidth}px - 0.5em);
}

.${id}-swatch {
  width: ${+swatchWidth}px;
  height: ${+swatchHeight}px;
  margin: 0 0.5em 0 0;
}


  </style>
  <div style=${
    {width: "100%", columns}
     }>${domain.map(value => {
    const label = `${format(value)}`;
    return html`<div class=${id}-item>

      <div class=${id}-label title=${label}>${label}</div>
    </div>`;
  })}
  </div>
</div>`;

  return html`<div style="display: flex; align-items: center; min-height: 33px; margin-left: ${+marginLeft}px; font: 10px sans-serif;">
  <style>

.${id} {
  display: inline-flex;
  align-items: center;
  margin-right: 1em;
}

.${id}::before {
  content: "";
  width: ${+swatchWidth}px;
  height: ${+swatchHeight}px;
  margin-right: 0.5em;
  background: var(--color);
}

  </style>
  <div>${domain.map(value => html`<span class="${id}" style="--color: ${color(value)}">${format(value)}</span>`)}</div>`;
}
	// Copyright 2021 Observable, Inc.
// Released under the ISC license.
// https://observablehq.com/@d3/treemap
function Treemap(data, { // data is either tabular (array of objects) or hierarchy (nested objects)
  path, // as an alternative to id and parentId, returns an array identifier, imputing internal nodes
  id = Array.isArray(data) ? d => d.id : null, // if tabular data, given a d in data, returns a unique identifier (string)
  parentId = Array.isArray(data) ? d => d.parentId : null, // if tabular data, given a node d, returns its parent’s identifier
  children, // if hierarchical data, given a d in data, returns its children
  value, // given a node d, returns a quantitative value (for area encoding; null for count)
  sort = (a, b) => d3.descending(a.value, b.value), // how to sort nodes prior to layout
  label, // given a leaf node d, returns the name to display on the rectangle
  group, // given a leaf node d, returns a categorical value (for color encoding)
  title, // given a leaf node d, returns its hover text
  link, // given a leaf node d, its link (if any)
  linkTarget = "_blank", // the target attribute for links (if any)
  tile = d3.treemapBinary, // treemap strategy
  width = 640, // outer width, in pixels
  height = 400, // outer height, in pixels
  margin = 0, // shorthand for margins
  marginTop = margin, // top margin, in pixels
  marginRight = margin, // right margin, in pixels
  marginBottom = margin, // bottom margin, in pixels
  marginLeft = margin, // left margin, in pixels
  padding = 1, // shorthand for inner and outer padding
  paddingInner = padding, // to separate a node from its adjacent siblings
  paddingOuter = padding, // shorthand for top, right, bottom, and left padding
  paddingTop = paddingOuter, // to separate a node’s top edge from its children
  paddingRight = paddingOuter, // to separate a node’s right edge from its children
  paddingBottom = paddingOuter, // to separate a node’s bottom edge from its children
  paddingLeft = paddingOuter, // to separate a node’s left edge from its children
  round = true, // whether to round to exact pixels
  colors = d3.schemeTableau10, // array of colors
  zDomain, // array of values for the color scale
  fill = "#ccc", // fill for node rects (if no group color encoding)
  fillOpacity = group == null ? null : 0.6, // fill opacity for node rects
  stroke, // stroke for node rects
  strokeWidth, // stroke width for node rects
  strokeOpacity, // stroke opacity for node rects
  strokeLinejoin, // stroke line join for node rects
} = {}) {

  // If id and parentId options are specified, or the path option, use d3.stratify
  // to convert tabular data to a hierarchy; otherwise we assume that the data is
  // specified as an object {children} with nested objects (a.k.a. the “flare.json”
  // format), and use d3.hierarchy.
  const root = path != null ? d3.stratify().path(path)(data)
      : id != null || parentId != null ? d3.stratify().id(id).parentId(parentId)(data)
      : d3.hierarchy(data, children);

  // Compute the values of internal nodes by aggregating from the leaves.
  value == null ? root.count() : root.sum(d => Math.max(0, value(d)));

  // Prior to sorting, if a group channel is specified, construct an ordinal color scale.
  const leaves = root.leaves();
  const G = group == null ? null : leaves.map(d => group(d.data, d));
  if (zDomain === undefined) zDomain = G;
  zDomain = new d3.InternSet(zDomain);
  const color = group == null ? null : d3.scaleOrdinal(zDomain, colors);

  // Compute labels and titles.
  const L = label == null ? null : leaves.map(d => label(d.data, d));
  const T = title === undefined ? L : title == null ? null : leaves.map(d => title(d.data, d));

  // Sort the leaves (typically by descending value for a pleasing layout).
  if (sort != null) root.sort(sort);

  // Compute the treemap layout.
  d3.treemap()
      .tile(tile)
      .size([width - marginLeft - marginRight, height - marginTop - marginBottom])
      .paddingInner(paddingInner)
      .paddingTop(paddingTop)
      .paddingRight(paddingRight)
      .paddingBottom(paddingBottom)
      .paddingLeft(paddingLeft)
      .round(round)
    (root);

  const svg = d3.create("svg")
      .attr("viewBox", [-marginLeft, -marginTop, width, height])
      .attr("width", width)
      .attr("height", height)
      .attr("style", "max-width: 100%; height: auto; height: intrinsic;")
      .attr("font-family", "sans-serif")
      .attr("font-size", 10);

  const node = svg.selectAll("a")
    .data(leaves)
    .join("a")
      .attr("xlink:href", link == null ? null : (d, i) => link(d.data, d))
      .attr("target", link == null ? null : linkTarget)
      .attr("transform", d => `translate(${d.x0},${d.y0})`);

  node.append("rect")
      .attr("fill", color ? (d, i) => color(G[i]) : fill)
      .attr("fill-opacity", fillOpacity)
      .attr("stroke", stroke)
      .attr("stroke-width", strokeWidth)
      .attr("stroke-opacity", strokeOpacity)
      .attr("stroke-linejoin", strokeLinejoin)
      .attr("width", d => d.x1 - d.x0)
      .attr("height", d => d.y1 - d.y0);

  if (T) {
    node.append("title").text((d, i) => T[i]);
  }

  if (L) {
    // A unique identifier for clip paths (to avoid conflicts).
    const uid = `O-${Math.random().toString(16).slice(2)}`;

    node.append("clipPath")
       .attr("id", (d, i) => `${uid}-clip-${i}`)
     .append("rect")
       .attr("width", d => d.x1 - d.x0)
       .attr("height", d => d.y1 - d.y0);

    node.append("text")
        .attr("clip-path", (d, i) => `url(${new URL(`#${uid}-clip-${i}`, location)})`)
      .selectAll("tspan")
      .data((d, i) => `${L[i]}`.split(/\n/g))
      .join("tspan")
        .attr("x", 3)
        .attr("y", (d, i, D) => `${(i === D.length - 1) * 0.3 + 1.1 + i * 0.9}em`)
        .attr("fill-opacity", (d, i, D) => i === D.length - 1 ? 0.7 : null)
        .text(d => d);
  }

  return Object.assign(svg.node(), {scales: {color}});
}

    const data = [{'name': 'BR-GO.maize grain production', 'weight': 0.0009052705554623056}, {'name': 'BR-MS.maize grain production', 'weight': 0.0005004960915150108}, {'name': 'BR-MT.maize grain production', 'weight': 0.0014549687145251683}, {'name': 'BR-PR.maize grain production', 'weight': 0.0011757749307657046}, {'name': 'BR-RS.maize grain production', 'weight': 0.0006900124093369528}, {'name': 'CN.hard coal mine operation and hard coal preparation', 'weight': 0.0003665084866608257}, {'name': 'DE.heat and power co-generation, natural gas, conventional power plant, 100MW electrical', 'weight': 0.0002471406625565471}, {'name': 'Europe without Switzerland.heat production, natural gas, at industrial furnace >100kW', 'weight': 0.004638009770161864}, {'name': 'RU.natural gas, burned in gas turbine, for compressor station', 'weight': 0.00025183630076012955}, {'name': 'RoW.ammonia production, partial oxidation, liquid', 'weight': 0.0005917764115208736}, {'name': 'RoW.ammonia production, steam reforming, liquid', 'weight': 0.0005622962940802511}, {'name': 'RoW.heat production, at hard coal industrial furnace 1-10MW', 'weight': 0.0006421555764403681}, {'name': 'ZA.maize grain production, rainfed', 'weight': 0.0002712034476489891}, {'name': 'other.aluminium production, primary, liquid, prebake', 'weight': 9.035676835947576e-06}, {'name': 'other.ammonia production, partial oxidation, liquid', 'weight': 4.895530946427285e-05}, {'name': 'other.ammonia production, steam reforming, liquid', 'weight': 0.00028375788016068727}, {'name': 'other.anaerobic digestion of manure', 'weight': 2.701448153147629e-06}, {'name': 'other.application of plant protection product, by field sprayer', 'weight': 3.9713653600759335e-05}, {'name': 'other.benzene production', 'weight': 4.489868835026982e-06}, {'name': 'other.carbon black production', 'weight': 6.083414499717067e-06}, {'name': 'other.clay brick production', 'weight': 1.3463922413293284e-05}, {'name': 'other.clear-cutting, primary forest to arable land, annual crop', 'weight': 8.353498125251853e-06}, {'name': 'other.clinker production', 'weight': 7.240504835668618e-05}, {'name': 'other.coking', 'weight': 1.9108884569032653e-05}, {'name': 'other.combine harvesting', 'weight': 0.0001243639799167117}, {'name': 'other.dehydrogenation of butan-1,4-diol', 'weight': 8.144510646800141e-05}, {'name': 'other.diesel production, low-sulfur, petroleum refinery operation', 'weight': 3.644315547843503e-05}, {'name': 'other.diesel production, petroleum refinery operation', 'weight': 4.1593736217703845e-05}, {'name': 'other.diesel, burned in building machine', 'weight': 7.587767015744749e-05}, {'name': 'other.diesel, burned in diesel-electric generating set, 10MW', 'weight': 3.6307137194388706e-05}, {'name': 'other.drying of maize grain', 'weight': 2.354037765531151e-05}, {'name': 'other.drying, natural gas', 'weight': 5.0216276768828553e-05}, {'name': 'other.electricity production, hard coal', 'weight': 0.0023823750381640994}, {'name': 'other.electricity production, hard coal, at coal mine power plant', 'weight': 5.896847263651823e-05}, {'name': 'other.electricity production, hard coal, conventional', 'weight': 0.0001155380218840226}, {'name': 'other.electricity production, hydro, reservoir, tropical region', 'weight': 1.0733965294281667e-05}, {'name': 'other.electricity production, lignite', 'weight': 0.00033543466126395225}, {'name': 'other.electricity production, natural gas, combined cycle power plant', 'weight': 0.00020415197235321692}, {'name': 'other.electricity production, natural gas, conventional power plant', 'weight': 0.0003288721324611368}, {'name': 'other.electricity production, oil', 'weight': 0.0001696210169764375}, {'name': 'other.ethylene production, average', 'weight': 4.144905595233564e-05}, {'name': 'other.evaporation of natural gas', 'weight': 3.5365964962708262e-06}, {'name': 'other.excavation, skid-steer loader', 'weight': 5.30409963357492e-06}, {'name': 'other.ferrochromium production, high-carbon, 68% Cr', 'weight': 4.046250233542077e-06}, {'name': 'other.fertilising, by broadcaster', 'weight': 2.7776233724082514e-05}, {'name': 'other.hard coal mine operation', 'weight': 5.739590839977821e-05}, {'name': 'other.hard coal mine operation and hard coal preparation', 'weight': 7.765251884601567e-05}, {'name': 'other.hardwood forestry, eucalyptus ssp., planted forest management', 'weight': 2.93029337755682e-05}, {'name': 'other.heat and power co-generation, hard coal', 'weight': 0.0001117117944389379}, {'name': 'other.heat and power co-generation, lignite', 'weight': 8.873648791936297e-05}, {'name': 'other.heat and power co-generation, natural gas, 1MW electrical, lean burn', 'weight': 0.00012532727370018475}, {'name': 'other.heat and power co-generation, natural gas, 200kW electrical, lean burn', 'weight': 9.646593165512963e-06}, {'name': 'other.heat and power co-generation, natural gas, 500kW electrical, lean burn', 'weight': 7.491266576250094e-06}, {'name': 'other.heat and power co-generation, natural gas, combined cycle power plant, 400MW electrical', 'weight': 0.00036320060748791776}, {'name': 'other.heat and power co-generation, natural gas, conventional power plant, 100MW electrical', 'weight': 0.001267876130025715}, {'name': 'other.heat and power co-generation, oil', 'weight': 2.955219745335214e-06}, {'name': 'other.heat production, anthracite, at stove 5-15kW', 'weight': 8.557409492765014e-05}, {'name': 'other.heat production, at coal coke industrial furnace 1-10MW', 'weight': 2.9349700776082857e-05}, {'name': 'other.heat production, at hard coal industrial furnace 1-10MW', 'weight': 2.1430327260488504e-05}, {'name': 'other.heat production, hard coal briquette, stove 5-15kW', 'weight': 6.508105626777364e-06}, {'name': 'other.heat production, heavy fuel oil, at industrial furnace 1MW', 'weight': 5.334925171716578e-05}, {'name': 'other.heat production, light fuel oil, at boiler 100kW, non-modulating', 'weight': 2.3126645454976674e-06}, {'name': 'other.heat production, light fuel oil, at industrial furnace 1MW', 'weight': 0.00017456675617440724}, {'name': 'other.heat production, lignite briquette, at stove 5-15kW', 'weight': 2.8375028832152102e-06}, {'name': 'other.heat production, natural gas, at boiler condensing modulating >100kW', 'weight': 0.00010274579956192124}, {'name': 'other.heat production, natural gas, at boiler modulating >100kW', 'weight': 0.000281729158661748}, {'name': 'other.heat production, natural gas, at industrial furnace >100kW', 'weight': 0.0003187805006658575}, {'name': 'other.heat production, natural gas, at industrial furnace low-NOx >100kW', 'weight': 0.00020544870797059385}, {'name': 'other.heavy fuel oil production, petroleum refinery operation', 'weight': 5.341036098565488e-06}, {'name': 'other.hydrogen cyanide production', 'weight': 1.5109241897563297e-05}, {'name': 'other.iron sinter production', 'weight': 5.244740273367828e-05}, {'name': 'other.light fuel oil production, petroleum refinery operation', 'weight': 1.038910778844061e-05}, {'name': 'other.limestone and gypsum application, by spreader', 'weight': 2.5484612276773e-06}, {'name': 'other.maize grain production', 'weight': 8.105248710308336e-06}, {'name': 'other.maize seed production, at farm', 'weight': 2.6574039431800026e-05}, {'name': 'other.market for electricity, high voltage', 'weight': 4.1625685347912365e-06}, {'name': 'other.market for electricity, medium voltage', 'weight': 5.64277472927214e-06}, {'name': 'other.market for natural gas, high pressure', 'weight': 6.0415548615324614e-05}, {'name': 'other.market for natural gas, low pressure', 'weight': 2.374564516659517e-06}, {'name': 'other.mowing, by rotary mower', 'weight': 3.45135849171195e-06}, {'name': 'other.natural gas production', 'weight': 0.00021782561088593943}, {'name': 'other.natural gas production, unprocessed, at extraction', 'weight': 7.294562150486994e-05}, {'name': 'other.natural gas venting from petroleum/natural gas production', 'weight': 2.3494682134060357e-05}, {'name': 'other.natural gas, burned in gas motor, for storage', 'weight': 0.00013021031418606116}, {'name': 'other.natural gas, burned in gas turbine, for compressor station', 'weight': 0.0002491283127862814}, {'name': 'other.nitric acid production, product in 50% solution state', 'weight': 0.0001766670120819489}, {'name': 'other.pesticide production, unspecified', 'weight': 4.915534981299596e-06}, {'name': 'other.petroleum and gas production, off-shore', 'weight': 6.932281659805538e-06}, {'name': 'other.petroleum and gas production, on-shore', 'weight': 3.1474975334865037e-06}, {'name': 'other.phosphate rock beneficiation', 'weight': 8.858517679289307e-06}, {'name': 'other.pig iron production', 'weight': 0.0001267619169099402}, {'name': 'other.pitch production, petroleum refinery operation', 'weight': 3.974026200129868e-06}, {'name': 'other.planting with starter fertiliser, by no till planter', 'weight': 5.865064367425841e-05}, {'name': 'other.propylene production', 'weight': 1.5647129336203925e-05}, {'name': 'other.quicklime production, in pieces, loose', 'weight': 2.5348190177790574e-05}, {'name': 'other.refinery gas, burned in furnace', 'weight': 3.0882745015971767e-06}, {'name': 'other.sour gas, burned in gas turbine', 'weight': 3.117856506998019e-05}, {'name': 'other.sowing', 'weight': 8.649093529265038e-06}, {'name': 'other.sponge iron production', 'weight': 3.187335224189259e-06}, {'name': 'other.steel production, converter, unalloyed', 'weight': 8.363708694078066e-06}, {'name': 'other.sulfur production, petroleum refinery operation', 'weight': 5.418172051660543e-06}, {'name': 'other.sweet gas, burned in gas turbine', 'weight': 0.00013429618485786117}, {'name': 'other.sweetening, natural gas', 'weight': 5.839138285458784e-05}, {'name': 'other.synthetic fuel production, from coal, high temperature Fisher-Tropsch operations', 'weight': 1.8248528995011714e-05}, {'name': 'other.tillage, harrowing, by rotary harrow', 'weight': 3.091211496527828e-05}, {'name': 'other.tillage, ploughing', 'weight': 3.3644742586070805e-05}, {'name': 'other.transport, freight train, diesel', 'weight': 0.00010098510647476237}, {'name': 'other.transport, freight train, steam', 'weight': 2.4113890180773706e-06}, {'name': 'other.transport, freight, inland waterways, barge', 'weight': 1.4203306803291939e-05}, {'name': 'other.transport, freight, light commercial vehicle', 'weight': 4.1902250867461825e-06}, {'name': 'other.transport, freight, lorry 16-32 metric ton, EURO3', 'weight': 7.726990316861506e-05}, {'name': 'other.transport, freight, lorry 16-32 metric ton, EURO4', 'weight': 6.211333975521639e-05}, {'name': 'other.transport, freight, lorry 16-32 metric ton, EURO5', 'weight': 3.733937793764062e-05}, {'name': 'other.transport, freight, lorry 16-32 metric ton, EURO6', 'weight': 3.2235774821712097e-06}, {'name': 'other.transport, freight, lorry 3.5-7.5 metric ton, EURO3', 'weight': 2.6498785291000565e-05}, {'name': 'other.transport, freight, lorry 3.5-7.5 metric ton, EURO4', 'weight': 1.2603361092135033e-05}, {'name': 'other.transport, freight, lorry 3.5-7.5 metric ton, EURO5', 'weight': 1.3384955995501775e-05}, {'name': 'other.transport, freight, lorry 7.5-16 metric ton, EURO3', 'weight': 1.2350528096620565e-05}, {'name': 'other.transport, freight, lorry 7.5-16 metric ton, EURO4', 'weight': 7.1006855741436805e-06}, {'name': 'other.transport, freight, lorry 7.5-16 metric ton, EURO5', 'weight': 7.126571400333913e-06}, {'name': 'other.transport, freight, lorry >32 metric ton, EURO3', 'weight': 0.00016562892375340788}, {'name': 'other.transport, freight, lorry >32 metric ton, EURO4', 'weight': 6.358700865050829e-05}, {'name': 'other.transport, freight, lorry >32 metric ton, EURO5', 'weight': 4.684710930603151e-05}, {'name': 'other.transport, freight, lorry >32 metric ton, EURO6', 'weight': 3.2309856838491322e-06}, {'name': 'other.transport, freight, sea, bulk carrier for dry goods', 'weight': 2.7777574011464668e-05}, {'name': 'other.transport, freight, sea, container ship', 'weight': 5.755746506799033e-05}, {'name': 'other.transport, freight, sea, tanker for liquefied natural gas', 'weight': 1.560533508577e-05}, {'name': 'other.transport, freight, sea, tanker for petroleum', 'weight': 1.285460719275423e-05}, {'name': 'other.transport, pipeline, long distance, natural gas', 'weight': 0.00027998712572897615}, {'name': 'other.transport, pipeline, offshore, long distance, natural gas', 'weight': 3.696961690786081e-06}, {'name': 'other.transport, pipeline, onshore, long distance, natural gas', 'weight': 2.0270183510385508e-05}, {'name': 'other.transport, tractor and trailer, agricultural', 'weight': 6.405270614104199e-05}, {'name': 'other.treatment of blast furnace gas, in power plant', 'weight': 1.0945980794926122e-05}, {'name': 'other.treatment of waste mineral oil, hazardous waste incineration', 'weight': 3.5499302526308457e-06}, {'name': 'other.treatment of waste mineral oil, hazardous waste incineration, with energy recovery', 'weight': 3.551400828326844e-06}, {'name': 'other.treatment of waste natural gas, sour, burned in production flare', 'weight': 1.4802863282674218e-05}, {'name': 'other.treatment of waste natural gas, sweet, burned in production flare', 'weight': 5.5732655291409054e-05}, {'name': 'other.treatment of waste polyethylene, municipal incineration', 'weight': 6.176718685662927e-06}, {'name': 'other.treatment of waste polyethylene, open burning', 'weight': 4.030973321617367e-06}, {'name': 'other', 'size': 'null'}, {'name': 'RoW', 'size': 'null'}, {'name': 'Europe without Switzerland', 'size': 'null'}, {'name': 'RU', 'size': 'null'}, {'name': 'CN', 'size': 'null'}, {'name': 'ZA', 'size': 'null'}, {'name': 'BR-MS', 'size': 'null'}, {'name': 'DE', 'size': 'null'}, {'name': 'BR-PR', 'size': 'null'}, {'name': 'BR-MT', 'size': 'null'}, {'name': 'BR-RS', 'size': 'null'}, {'name': 'BR-GO', 'size': 'null'}];


    document.addEventListener('DOMContentLoaded', function () {
        chart = Treemap(data, {
          path: d => d.name.replace(/\./g, "/"),
          value: d => d?.weight, // size of each node (file); null for internal nodes (folders)
          group: d => d.name.split(".")[0],
          label: (d, n) => [...d.name.split(".").pop().split(/(?=[A-Z][a-z])/g), n.value.toLocaleString("en")].join("\n"),
          title: (d, n) => `${d.name}\n${n.value.toLocaleString("en")}`, // text to show on hover
          tile: d3.treemapBinary, // e.g., d3.treemapBinary; set by input above
          width: 1200,
          height: 1200
        })

        document.getElementById("chart").appendChild(chart);
        key = Swatches(chart.scales.color)
        document.getElementById("legend").appendChild(key);
    });



</script>

<div id="legend" style="margin-left:5px;margin-top:5px;width:1000px;height:50px"></div>
<div id="chart" style="margin-left:5px;margin-top:5px;width:1000px;height:500px"></div>

</body>
</html>